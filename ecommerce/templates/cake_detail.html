{% extends "master.html" %}
{% load static %}

{% block title %}{{ cake.name }} | Bakeora{% endblock %}

{% block content %}

<section class="container py-5">
  <div class="row">
    <!-- Cake Image -->
    <div class="col-md-6">
      <img src="{{ cake.image.url }}" class="img-fluid" alt="{{ cake.name }}">
    </div>

    <!-- Cake Info -->
    <div class="col-md-6">
      <h2>{{ cake.name }}</h2>
      <h4 class="text-success">₹{{ cake.price }}</h4>

      <!-- Add to Cart -->
      <button class="btn btn-dark mb-2 add-to-cart-btn" data-product-id="{{ cake.id }}">
        Add to Cart
      </button>

      <!-- Buy Now -->
      <a href="{% url 'buy_now' cake.id %}" class="btn btn-primary">Buy Now</a>
    </div>
  </div>
</section>

<script>
document.querySelectorAll('.add-to-cart-btn').forEach(button => {
  button.addEventListener('click', function () {
    const productId = this.dataset.productId;

    fetch(`/cart/add/${productId}/`, {
      method: "POST",
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
        "X-Requested-With": "XMLHttpRequest"
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        const cartCountElem = document.getElementById("cart-count");
        if (cartCountElem) cartCountElem.textContent = data.cart_count;
      } else {
        alert("Failed to add to cart ❌");
      }
    })
    .catch(error => console.error("Error:", error));
  });
});
</script>

{% endblock %}
