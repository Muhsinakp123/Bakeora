{% extends "master.html" %}
{% load static %}

{% block title %}Cakes | Bakeora{% endblock %}

{% block content %}

<!-- ================= CAKES HERO (SPLIT LAYOUT) ================= -->

<section class="cakes-hero-split">
  <div class="container">
    <div class="row align-items-center">

      <!-- LEFT IMAGE COLLAGE -->
      <div class="col-lg-6 position-relative">
        <div class="cakes-hero-images-grid">

          <div class="hero-grid-img">
            <img src="{% static 'images/cake-hero-1.jpg' %}" alt="Cake Image 1">
          </div>

          <div class="hero-grid-img">
            <img src="{% static 'images/cake-hero-2.jpg' %}" alt="Cake Image 2">
          </div>

        </div>

      </div>

      <!-- RIGHT CONTENT -->
      <div class="col-lg-6">
        <div class="cakes-hero-content">
          <h1>
            The Home of <br>
            <span>Superior Cakes</span>
          </h1>

          <p>
            Be it a slice from the shop, a custom cake or a dessert box to your
            door, we pride ourselves on crafting handcrafted cakes for every
            celebration.
          </p>

          <a href="{% url 'custom_order' %}" class="btn btn-lg mt-3 order-btn">Custom Order</a>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- ================= BEST SELLERS ================= -->
<section class="cakes-best-sellers">
  <div class="container text-center">

    <h2 class="cakes-section-title">
      Best Sellers
      <span class="cakes-title-divider"></span>
    </h2>

    <p class="cakes-section-subtitle">
      Our most loved cakes, chosen by customers
    </p>

    <div class="row g-4 mt-4">

      <!-- Card -->
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="bs-gold-frame">
          <div class="bs-card">
            <img src="{% static 'images/ctc.jpg' %}" alt="Chocolate Truffle Cake">
            <div class="bs-card-info">
              <h5>Chocolate Truffle</h5>
              <span>₹1,250</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="bs-gold-frame">
          <div class="bs-card">
            <img src="{% static 'images/rvc.jpg' %}" alt="Red Velvet Cake">
            <div class="bs-card-info">
              <h5>Red Velvet</h5>
              <span>₹1,150</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="bs-gold-frame">
          <div class="bs-card">
            <img src="{% static 'images/floral.jpg' %}" alt="Floral Wedding Cake">
            <div class="bs-card-info">
              <h5>Floral Wedding Cake</h5>
              <span>₹3,500</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="bs-gold-frame">
          <div class="bs-card">
            <img src="{% static 'images/lbc.jpg' %}" alt="Lemon Blueberry Cake">
            <div class="bs-card-info">
              <h5>Lemon Blueberry</h5>
              <span>₹1,300</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- CATEGORY FILTER -->
<section class="cakes-categories">
<div class="container">
<div class="text-center">
<h2 class="cakes-section-title">Available Delights <span class="cakes-title-divider"></span></h2>
<p class="cakes-section-subtitle">Explore our freshly prepared dessert collection</p>
</div>

<div class="cakes-category-row">

<a href="?{% for k,v in request.GET.items %}{% if k != 'category' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}category=all#c-grid"
class="cakes-category {% if not request.GET.category or request.GET.category == 'all' %}active{% endif %}">
<i class="fa-solid fa-gift"></i><span>All</span></a>

<a href="?{% for k,v in request.GET.items %}{% if k != 'category' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}category=wedding#c-grid"
class="cakes-category {% if request.GET.category == 'wedding' %}active{% endif %}">
<i class="bi bi-heart"></i><span>Wedding</span></a>

<a href="?{% for k,v in request.GET.items %}{% if k != 'category' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}category=birthday#c-grid"
class="cakes-category {% if request.GET.category == 'birthday' %}active{% endif %}">
<i class="bi bi-cake2"></i><span>Birthday</span></a>

<a href="?{% for k,v in request.GET.items %}{% if k != 'category' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}category=bento#c-grid"
class="cakes-category {% if request.GET.category == 'bento' %}active{% endif %}">
<i class="bi bi-box"></i><span>Bento</span></a>

<a href="?{% for k,v in request.GET.items %}{% if k != 'category' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}category=vegan#c-grid"
class="cakes-category {% if request.GET.category == 'vegan' %}active{% endif %}">
<i class="bi bi-leaf"></i><span>Vegan</span></a>

<a href="?{% for k,v in request.GET.items %}{% if k != 'category' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}category=kids#c-grid"
class="cakes-category {% if request.GET.category == 'kids' %}active{% endif %}">
<i class="bi bi-emoji-smile"></i><span>Kids</span></a>

</div>
</div>
</section>

<!-- ================= STICKY FILTER BAR ================= -->
<section class="cakes-filter-bar">
  <div class="container">
    <form method="get" class="cakes-filter-inner">
      {% if request.GET.category %}
      <input type="hidden" name="category" value="{{ request.GET.category }}">
      {% endif %}

      <!-- Flavor Filter -->
<select name="flavor" class="cakes-filter" onchange="this.form.submit()">
<option value="">Flavor</option>

{% for value,label in flavors %}
<option value="{{ value }}"
{% if request.GET.flavor == value %}selected{% endif %}>
{{ label }}
</option>
{% endfor %}
</select>



      <!-- Structure Filter -->
<select name="structure" class="cakes-filter" onchange="this.form.submit()">
<option value="">Structure</option>

{% for value,label in structures %}
<option value="{{ value }}"
{% if request.GET.structure == value %}selected{% endif %}>
{{ label }}
</option>
{% endfor %}
</select>

      <!-- Price Filter -->
<select name="price" class="cakes-filter" onchange="this.form.submit()">
  <option value="" hidden>Price</option>

  <option value="400-1000" {% if request.GET.price == '400-1000' %}selected{% endif %}>₹400 – ₹1000</option>

  <option value="1000-2000" {% if request.GET.price == '1000-2000' %}selected{% endif %}>₹1000 – ₹2000</option>

  <option value="2000-5000" {% if request.GET.price == '2000-5000' %}selected{% endif %}>₹2000 – ₹5000</option>

  <option value="low-high" {% if request.GET.price == 'low-high' %}selected{% endif %}>Low → High</option>

  <option value="high-low" {% if request.GET.price == 'high-low' %}selected{% endif %}>High → Low</option>
</select>

    </form>
  </div>
</section>


<!-- CAKE GRID -->
<section class="cakes-grid" id="c-grid">
<div class="container">
<div class="row g-4">

{% for cake in page_obj %}
<div class="col-12 col-sm-6 col-lg-3">
<div class="cake-card">

<a href="{% url 'cake_detail' cake.id %}">
{% if cake.image %}
<img src="{{ cake.image.url }}" alt="{{ cake.name }}">
{% endif %}
</a>

<div class="cake-info">
<a href="{% url 'cake_detail' cake.id %}">
<h5>{{ cake.name }}</h5>
</a>
<span>₹{{ cake.price }}</span>

{% if cake.ps %}
<button class="btn btn-dark add-to-cart-btn"
        data-url="{% url 'add_to_cart' cake.ps.id %}">
    Add to Cart
</button>
{% else %}
<span class="text-danger small">Unavailable</span>
{% endif %}


</div>
</div>
</div>
{% endfor %}

</div>
</div>
</section>


<!-- ================= PAGINATION ================= -->
<div class="pagination-wrap">
  <ul class="pagination justify-content-center">
    {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link"
        href="?{% for key,value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}#c-grid">Previous</a>
    </li>
    {% endif %}

{% for num in page_obj.paginator.page_range %}
  {% if num <= 3 %}
    {% if page_obj.number == num %}
      <li class="page-item active">
        <span class="page-link">{{ num }}</span>
      </li>
    {% else %}
      <li class="page-item">
        <a class="page-link"
           href="?{% for key,value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ num }}#c-grid">
           {{ num }}
        </a>
      </li>
    {% endif %}
  {% endif %}
{% endfor %}


    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link"
        href="?{% for key,value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}#c-grid">Next</a>
    </li>
    {% endif %}
  </ul>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  document.querySelectorAll('.add-to-cart-btn').forEach(button => {

    button.addEventListener('click', function () {

      const url = this.dataset.url;

      fetch(url, {
        method: "POST",
        headers: {
          "X-CSRFToken": getCookie("csrftoken"),
          "X-Requested-With": "XMLHttpRequest"
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("Added to cart ✅");

          const badge = document.getElementById("cart-count");
          if (badge) badge.textContent = data.cart_count;
        } else {
          alert("Failed ❌");
        }
      });

    });

  });

});
</script>

{% endblock %}
