{% extends "base.html" %}
{% block content %}

<style>
body {
    background-color: #f3f3f3;
}

.address-wrapper {
    max-width: 750px;
    margin: 40px auto;
}

.address-card {
    background: #ffffff;
    padding: 35px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.autofill-box {
    background: #e7f3f8;
    border: 1px solid #cce3ec;
    padding: 15px;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.form-label {
    font-weight: 600;
    font-size: 14px;
}

.btn-amazon {
    background-color: #ffd814;
    border: none;
    font-weight: 600;
}

.btn-amazon:hover {
    background-color: #f7ca00;
}
</style>

<div class="address-wrapper">

    <div class="address-card">

        <h4 class="fw-bold mb-3">Enter a new delivery address</h4>

        <!-- Autofill Box -->
        <div class="autofill-box mb-4">
            <div>Save time. Autofill your current location.</div>
            <button type="button" onclick="getLocation()" 
                class="btn btn-outline-secondary btn-sm">
                Autofill
            </button>
        </div>

        <form method="POST">
            {% csrf_token %}

            <div class="mb-3">
                <label class="form-label">Full name (First and Last name)</label>
                <input type="text" name="full_name" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Mobile number</label>
                <input type="text" name="phone" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Address Line</label>
                <textarea name="address_line" class="form-control" rows="3" required></textarea>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">City</label>
                    <input type="text" id="city" name="city" class="form-control" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">District</label>
                    <input type="text" id="district" name="district" class="form-control" required>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">State</label>
                    <input type="text" id="state" name="state" class="form-control" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Pincode</label>
                    <input type="text" id="pincode" name="pincode" class="form-control" required>
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label">Country</label>
                <input type="text" id="country" name="country" class="form-control" required>
            </div>

            <button type="submit" class="btn btn-amazon w-100">
                Use this address
            </button>

        </form>

    </div>
</div>

<script>
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        alert("Geolocation not supported.");
    }
}

function showPosition(position) {
    fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${position.coords.latitude}&lon=${position.coords.longitude}`)
        .then(res => res.json())
        .then(data => {

            const addr = data.address;

            document.getElementById("city").value =
                addr.city || addr.town || addr.village || "";

            document.getElementById("district").value =
                addr.state_district || "";

            document.getElementById("state").value =
                addr.state || "";

            document.getElementById("country").value =
                addr.country || "";

            document.getElementById("pincode").value =
                addr.postcode || "";
        });
}

function showError(error) {
    alert("Location permission denied or unavailable.");
}
</script>

{% endblock %}