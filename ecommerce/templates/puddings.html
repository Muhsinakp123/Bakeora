{% extends "master.html" %}
{% load static %}

{% block title %}Puddings | Bakeora{% endblock %}

{% block content %}

<!-- ===== PUDDING HERO — LUXURY SPLIT ===== -->
<section class="puddings-hero-lux">
  <div class="container">
    <div class="row align-items-center">

      <!-- LEFT CONTENT -->
      <div class="col-lg-6">
        <div class="puddings-hero-text">
          <h1>Puddings Crafted<br>to Perfection</h1>

          <p>
            Indulge in our selection of artisanal puddings and creamy
            delights made from the finest ingredients.
          </p>

          <!-- small preview cards -->
          <div class="puddings-mini-row">

            <div class="mini-card">
              <img src="{% static 'images/pudding-hero1.jpg' %}">
              <span>Golden Honeycomb Custard</span>
            </div>

            <div class="mini-card">
              <img src="{% static 'images/pudding-hero2.jpg' %}">
              <span>Toffee Bread & Butter</span>
            </div>

            <div class="mini-card">
              <img src="{% static 'images/pudding-hero3.jpg' %}">
              <span>White Chocolate Spiced Chai</span>
            </div>

            <div class="mini-card">
              <img src="{% static 'images/pudding-hero4.jpg' %}">
              <span>Coconut Raspberry Chia</span>
            </div>

          </div>
        </div>
      </div>


      <!-- RIGHT IMAGE -->
      <div class="col-lg-6 text-center">
        <div class="puddings-hero-frame">
          <img src="{% static 'images/pudding-hero-main.png' %}" alt="">
        </div>
      </div>

    </div>
  </div>
</section>

<!-- ================= BEST SELLING PUDDINGS ================= -->
<section class="cakes-best-sellers">
  <div class="container text-center">

    <h2 class="cakes-section-title">
      Best Sellers
      <span class="cakes-title-divider"></span>
    </h2>

    <p class="cakes-section-subtitle">
      Our most loved puddings
    </p>

    <div class="row g-4 mt-4">

      <!-- Card -->
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="bs-gold-frame">
          <div class="bs-card">
            <img src="{% static 'images/pudding3.jpg' %}" alt="">
            <div class="bs-card-info">
              <h5>Caramel Custard</h5>
              <span>₹260</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="bs-gold-frame">
          <div class="bs-card">
            <img src="{% static 'images/pudding1.jpg' %}" alt="">
            <div class="bs-card-info">
              <h5>Chocolate Lava Pudding</h5>
              <span>₹280</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="bs-gold-frame">
          <div class="bs-card">
            <img src="{% static 'images/pudding2.jpg' %}" alt="">
            <div class="bs-card-info">
              <h5>Mango Chia Pudding</h5>
              <span>₹240</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="bs-gold-frame">
          <div class="bs-card">
            <img src="{% static 'images/pudding4.jpg' %}" alt="">
            <div class="bs-card-info">
              <h5>Berry Cream Pudding</h5>
              <span>₹300</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- ===== FILTER TABS ===== -->
<section class="puddings-filter-bar">
  <div class="container">

    <div class="text-center">
      <h2 class="cakes-section-title">
        Available Delights
        <span class="cakes-title-divider"></span>
      </h2>

      <p class="cakes-section-subtitle">
        Explore our freshly prepared pudding collection
      </p>
    </div>

<div class="puddings-filters">

<a href="?{% for k,v in request.GET.items %}{% if k != 'type' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}type=all#grid"
   class="pudding-filter {% if not request.GET.type or request.GET.type == 'all' %}active{% endif %}">
   All
</a>

<a href="?{% for k,v in request.GET.items %}{% if k != 'type' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}type=warm#grid"
   class="pudding-filter {% if request.GET.type == 'warm' %}active{% endif %}">
   Warm
</a>

<a href="?{% for k,v in request.GET.items %}{% if k != 'type' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}type=chilled#grid"
   class="pudding-filter {% if request.GET.type == 'chilled' %}active{% endif %}">
   Chilled
</a>

<a href="?{% for k,v in request.GET.items %}{% if k != 'type' and k != 'page' %}{{k}}={{v}}&{% endif %}{% endfor %}type=vegan#grid"
   class="pudding-filter {% if request.GET.type == 'vegan' %}active{% endif %}">
   Vegan
</a>

</div>


  </div>
</section>

<!-- ===== FILTER BAR ===== -->
<section class="cakes-filter-bar">
  <div class="container">
    <form method="get" class="cakes-filter-inner">

  <!-- keep tab filter -->
  {% if request.GET.type %}
  <input type="hidden" name="type" value="{{ request.GET.type }}">
  {% endif %}

  <!-- FLAVOR -->
  <select name="flavor" class="cakes-filter" onchange="this.form.submit()">
    <option value="" hidden>Flavor</option>

    <option value="chocolate" {% if request.GET.flavor == 'chocolate' %}selected{% endif %}>Chocolate</option>
    <option value="vanilla" {% if request.GET.flavor == 'vanilla' %}selected{% endif %}>Vanilla</option>
    <option value="fruit" {% if request.GET.flavor == 'fruit' %}selected{% endif %}>Fruit</option>
    <option value="pistachio" {% if request.GET.flavor == 'pistachio' %}selected{% endif %}>Pistachio</option>
    <option value="strawberry" {% if request.GET.flavor == 'strawberry' %}selected{% endif %}>Strawberry</option>
    <option value="mango" {% if request.GET.flavor == 'mango' %}selected{% endif %}>Mango</option>
  </select>

  <!-- PRICE -->
  <select name="price" class="cakes-filter" onchange="this.form.submit()">
    <option value="" hidden>Price</option>

    <option value="150-450" {% if request.GET.price == '150-450' %}selected{% endif %}>
      ₹150 – ₹450
    </option>

    <option value="450-800" {% if request.GET.price == '450-800' %}selected{% endif %}>
      ₹450 – ₹800
    </option>

    <option value="low-high" {% if request.GET.price == 'low-high' %}selected{% endif %}>
      Low → High
    </option>

    <option value="high-low" {% if request.GET.price == 'high-low' %}selected{% endif %}>
      High → Low
    </option>
  </select>

</form>

  </div>
</section>

<!-- ===== PUDDING GRID (CAKE STYLE CARDS) ===== -->
<section class="cakes-grid" id="grid">
  <div class="container">
    <div class="row g-4">

      {% for pudding in page_obj %}
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="cake-card">
          <img src="{{ pudding.image.url }}" alt="{{ pudding.name }}">

          <div class="cake-info">
            <h5>{{ pudding.name }}</h5>
            <span>₹{{ pudding.price }}</span>

            <button class="btn btn-sm add-to-cart-btn" data-product-id="{{ pudding.id }}">
              Add to Cart
            </button>
          </div>
        </div>
      </div>
      {% empty %}
      <p class="text-center">No puddings available</p>
      {% endfor %}

    </div>
  </div>
</section>


<!-- ================= PAGINATION (MATCH CAKES PAGE) ================= -->
<div class="pagination-wrap">
  <ul class="pagination justify-content-center">

    {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link"
        href="?{% for key,value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}#grid">
        Previous
      </a>
    </li>
    {% endif %}

{% for num in page_obj.paginator.page_range %}
  {% if num <= 3 %}
    {% if page_obj.number == num %}
      <li class="page-item active">
        <span class="page-link">{{ num }}</span>
      </li>
    {% else %}
      <li class="page-item">
        <a class="page-link"
           href="?{% for key,value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ num }}#grid">
           {{ num }}
        </a>
      </li>
    {% endif %}
  {% endif %}
{% endfor %}


    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link"
        href="?{% for key,value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}#grid">
        Next
      </a>
    </li>
    {% endif %}

  </ul>
</div>


<!-- ===== ADD TO CART SCRIPT ===== -->
<script>
  document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', function () {

      const productId = this.dataset.productId;

      fetch(`/cart/add/${productId}/`, {
        method: "POST",
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
          "X-Requested-With": "XMLHttpRequest"
        }
      })
        .then(r => r.json())
        .then(data => alert(data.success ? "Added to cart ✅" : "Failed ❌"));
    });
  });
</script>

{% endblock %}